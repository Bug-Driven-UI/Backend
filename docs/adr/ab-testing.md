# ADR: Вынести A/B тестирование в отдельный сервис

Статус: **Предложено**

---

## Контекст

Сейчас A/B-тестирование реализовано на уровне nginx: трафик пользователей делится по заданным правилам, и разные группы
получают разные версии ответа.  
Подход работает, но имеет ряд проблем:

- Сложность поддержки и изменения правил в конфиге nginx;
- Отсутствие гибкости — невозможно динамически управлять экспериментами без деплоя конфигурации;
- Ограниченные возможности аналитики и трекинга участия пользователей в экспериментах;
- Отсутствие централизованного API для клиентов и админки.

При масштабировании BDUI-системы потребуется более удобное управление экспериментами, прозрачная аналитика и возможность
интеграции с внешними системами (например, Firebase).

---

## Решение

Вынести A/B-тестирование в отдельный сервис.

Функции сервиса:

- Управление экспериментами (создание, включение/выключение, конфигурация вариантов);
- API для клиентских приложений и backend-сервисов для получения варианта эксперимента;
- Сохранение и трекинг участия пользователя (assignment);
- Интеграция с аналитикой (логирование факта участия и выбранного варианта).

---

## Последствия

Преимущества:

+ Централизованное управление экспериментами;
+ Гибкая настройка и динамическое включение/выключение без деплоя;
+ Возможность интеграции с внешней аналитикой;
+ Масштабируемость при росте числа экспериментов.

Недостатки:

- Увеличение сложности инфраструктуры (отдельный сервис);
- Требуется миграция текущих правил из nginx в новый сервис;
- Необходима поддержка SLA и мониторинг для нового сервиса.

---

## Альтернативы

- Оставить логику на nginx: просто, но негибко, сложно развивать.
- Использовать сторонние готовые решения (например, LaunchDarkly, Firebase Remote Config): быстро, но зависимость от
  внешних SaaS, сложность интеграции с текущей архитектурой и высокие затраты.
